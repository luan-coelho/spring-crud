<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
  <body>
    <!-- 
      Componente Global de Alert Dialog
      Suporta:
      1. Navegação/Formulário Padrão (actionUrl definido)
      2. Callbacks JS / HTMX (onConfirm definido)
      
      Uso com HTMX:
      window.dispatchEvent(new CustomEvent('open-confirm-modal', {
          detail: {
              title: '...',
              message: '...',
              type: 'danger',
              onConfirm: () => { evt.detail.issueRequest(true); }
          }
      }));
    -->
    <div
      th:fragment="globalAlert"
      x-data="{ 
        open: false, 
        title: '', 
        message: '', 
        actionUrl: null, 
        type: 'info',
        confirmText: 'Confirmar',
        cancelText: 'Cancelar',
        onConfirm: () => {}
      }"
      x-on:open-confirm-modal.window="
        open = true; 
        title = $event.detail.title; 
        message = $event.detail.message; 
        actionUrl = $event.detail.actionUrl || null; 
        type = $event.detail.type || 'info';
        confirmText = $event.detail.confirmText || 'Confirmar';
        cancelText = $event.detail.cancelText || 'Cancelar';
        onConfirm = $event.detail.onConfirm || (() => {});
      "
      x-on:keydown.escape.window="open = false"
      style="display: none"
      x-show="open"
      class="relative z-50"
      aria-labelledby="modal-title"
      role="dialog"
      aria-modal="true"
    >
      <!-- Backdrop -->
      <div
        x-show="open"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-slate-900/75 backdrop-blur-sm transition-opacity"
      ></div>

      <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div
          class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"
        >
          <!-- Panel -->
          <div
            x-show="open"
            x-transition:enter="ease-out duration-300"
            x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
            x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
            x-transition:leave="ease-in duration-200"
            x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
            x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
            x-on:click.outside="open = false"
            class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg border border-slate-100"
          >
            <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
              <div class="sm:flex sm:items-start">
                <!-- Icons -->
                <div
                  :class="{
                    'bg-red-100': type === 'danger',
                    'bg-amber-100': type === 'warning',
                    'bg-indigo-100': type === 'info'
                  }"
                  class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full sm:mx-0 sm:h-10 sm:w-10 transition-colors"
                >
                  <svg
                    x-show="type === 'danger'"
                    class="h-6 w-6 text-red-600"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"
                    />
                  </svg>
                  <svg
                    x-show="type === 'warning'"
                    class="h-6 w-6 text-amber-600"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"
                    />
                  </svg>
                  <svg
                    x-show="type === 'info'"
                    class="h-6 w-6 text-indigo-600"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"
                    />
                  </svg>
                </div>

                <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                  <h3
                    class="text-lg font-semibold leading-6 text-slate-900"
                    id="modal-title"
                    x-text="title"
                  ></h3>
                  <div class="mt-2">
                    <p class="text-sm text-slate-500" x-text="message"></p>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="bg-slate-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-slate-100"
            >
              <!-- Case 1: Form Action -->
              <form
                x-show="actionUrl"
                :action="actionUrl"
                method="post"
                class="sm:ml-3"
              >
                <!-- Simulate DELETE for danger type if strict mode not used -->
                <input
                  type="hidden"
                  name="_method"
                  value="DELETE"
                  x-if="type === 'danger'"
                />

                <button
                  type="submit"
                  :class="{
                        'bg-red-600 hover:bg-red-500 focus-visible:outline-red-600': type === 'danger',
                        'bg-amber-600 hover:bg-amber-500 focus-visible:outline-amber-600': type === 'warning',
                        'bg-indigo-600 hover:bg-indigo-500 focus-visible:outline-indigo-600': type === 'info'
                    }"
                  class="inline-flex w-full justify-center rounded-lg px-4 py-2 text-sm font-semibold text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 sm:w-auto transition-all"
                  x-text="confirmText"
                ></button>
              </form>

              <!-- Case 2: JS Callback (HTMX) -->
              <button
                x-show="!actionUrl"
                type="button"
                :class="{
                    'bg-red-600 hover:bg-red-500 focus-visible:outline-red-600': type === 'danger',
                    'bg-amber-600 hover:bg-amber-500 focus-visible:outline-amber-600': type === 'warning',
                    'bg-indigo-600 hover:bg-indigo-500 focus-visible:outline-indigo-600': type === 'info'
                }"
                class="inline-flex w-full justify-center rounded-lg px-4 py-2 text-sm font-semibold text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 sm:w-auto transition-all sm:ml-3"
                x-on:click="onConfirm(); open = false"
                x-text="confirmText"
              ></button>

              <button
                type="button"
                class="mt-3 inline-flex w-full justify-center rounded-lg bg-white px-4 py-2 text-sm font-semibold text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 hover:bg-slate-50 sm:mt-0 sm:w-auto transition-all"
                x-on:click="open = false"
                x-text="cancelText"
              ></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
